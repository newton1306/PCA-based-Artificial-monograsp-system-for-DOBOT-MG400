# 🚀 วิวัฒนาการระบบ Robotic Grasping

## จากปัญหาสู่ทางออก: เส้นทางการพัฒนาจาก AI สู่ LIDAR

---

## โครงสร้างการพัฒนา

```
┌─────────────────────────────────────────────────────────────────┐
│                    DEVELOPMENT ROADMAP                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   PHASE 1: หาวิธี GRASP ที่ดีที่สุด                              │
│   ├── [v1] Grasp AI → ❌ ไม่แม่น                                │
│   ├── [v2] PCA Grasp → ✅ ดีมาก!                                │
│   └── [v3] PCA + Donut → ✅ ครอบคลุมทุกรูปทรง                   │
│                                                                 │
│   ─────────────────────────────────────────────────             │
│                                                                 │
│   PHASE 2: หาวิธีวัด DEPTH ที่ดีที่สุด                           │
│   ├── [v4] Depth AI → ❌ ไม่เสถียร                              │
│   └── [v5] LIDAR → ✅ แม่นยำมาก!                                │
│                                                                 │
│   ─────────────────────────────────────────────────             │
│                                                                 │
│   FINAL: ผนวกรวมระบบ                                            │
│   └── PCA + Donut + LIDAR → ✅ ระบบสมบูรณ์                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📊 ตารางสรุปไทม์ไลน์

| Phase | Version | ระบบที่ใช้ | ปัญหาที่เจอ | ผลลัพธ์ |
|:-----:|:-------:|:----------|:-----------|:--------|
| **1** | v1 | Grasp AI (Deep Learning) | มุมกล้องไม่ตรง Dataset, Gripper ไม่เหมาะ, จุดจับคลาดเคลื่อนสูง | ❌ ล้มเหลว |
| **1** | v2 | **PCA Grasp** | - | ✅ สำเร็จ! เลือกจุดจับได้ดีมาก |
| **1** | v3 | PCA + **Donut Detection** | วัตถุโดนัทต้องคีบที่ขอบ | ✅ ครอบคลุมทุกรูปทรง |
| | | **🎯 สรุป Phase 1: PCA + Donut คือระบบ Grasp ที่ดีที่สุด** | | |
| **2** | v4 | Depth AI (Depth Anything) | แสงมีผลมาก, Calibrate ยาก, ค่าไม่คงที่ | ❌ ล้มเหลว |
| **2** | v5 | **LIDAR (TF-Luna)** | - | ✅ สำเร็จ! วัดความสูงแม่นยำ |
| | | **🎯 สรุป Phase 2: LIDAR คือระบบวัดความสูงที่ดีที่สุด** | | |
| **Final** | v6 | **PCA + Donut + LIDAR** | - | ✅ ระบบสมบูรณ์ |

---

# 📝 รายละเอียดการพัฒนา

---

## PHASE 1: การหาวิธี Grasp ที่ดีที่สุด

> ในขั้นตอนแรกของการพัฒนา เราโฟกัสที่ปัญหาเดียวก่อน นั่นคือ **"จะเลือกจุดหยิบอย่างไรให้แม่นยำ?"** โดยยังไม่ไปยุ่งกับเรื่องความสูงหรือ Depth ใดๆ

---

### 🔴 [v1] เริ่มต้นด้วย Grasp AI

> เราเริ่มต้นด้วยการใช้ **Grasp AI** ซึ่งเป็น Deep Learning Model ที่เทรนมาจาก Dataset มาตรฐาน เช่น Cornell Grasping Dataset โดยหวังว่าจะได้ระบบที่ฉลาดและแม่นยำ
>
> **แต่เมื่อทดลองใช้จริง พบปัญหาใหญ่:**
>
> | ปัญหา | รายละเอียด |
> |-------|------------|
> | **มุมกล้องไม่ตรง** | Dataset เทรนจากมุม top-down แต่ setup ของเราต่างออกไป |
> | **Gripper ไม่เหมาะ** | โมเดลเทรนมาสำหรับ parallel-jaw gripper ขนาดใหญ่ แต่ของเราเป็น servo gripper เล็ก |
> | **จุดจับคลาดเคลื่อนมาก** | โมเดลแนะนำจุดจับที่ไม่สมเหตุสมผล บางครั้งชี้ไปกลางอากาศ หรือชี้ผิดมุมโดยสิ้นเชิง |
>
> **ข้อสรุป:** Grasp AI ใช้ไม่ได้กับ setup ของเรา → ต้องหาวิธีอื่น

---

### 🟢 [v2] เปลี่ยนมาใช้ PCA Grasp

> เมื่อ AI ไม่ตอบโจทย์ เราจึงลองใช้วิธีทางคณิตศาสตร์แทน นั่นคือ **PCA (Principal Component Analysis)** ซึ่งวิเคราะห์รูปร่างของวัตถุเพื่อหาแกนหลักและแกนรอง
>
> **ผลการทดลองน่าประหลาดใจมาก:**
>
> - PCA หา **แกนยาว** และ **แกนสั้น** ของวัตถุได้อัตโนมัติ
> - ระบบเลือก **คีบจากด้านสั้น** (ตั้งฉากกับแกนยาว)
> - นี่คือวิธีเดียวกับที่ **มนุษย์ใช้สัญชาตญาณเลือก!**
>
> **ตัวอย่าง:**
> - ปากกา (ยาว) → คีบขวาง ✅
> - กล่องสี่เหลี่ยมผืนผ้า → คีบด้านแคบ ✅
> - วัตถุกลม → คีบผ่านจุดศูนย์กลาง ✅
>
> **ข้อสรุป:** PCA เลือกจุดจับได้ดีมาก ตรงกับ sense ของมนุษย์

---

### 🟢 [v3] เพิ่ม Donut Detection

> เมื่อ PCA ใช้งานได้ดี เราก็เจอกรณีพิเศษ: **วัตถุทรงโดนัท** (วงกลมที่มีรูตรงกลาง)
>
> **ปัญหา:**
> - PCA มองโดนัทเป็น "วงกลมทั้งอัน" → ไม่มีแกนยาว-แกนสั้นชัดเจน
> - ถ้าพยายามคีบทั้งอัน → gripper ต้องเปิดกว้างมาก (เกินขีดจำกัด)
>
> **แนวคิดใหม่:**
> - โดนัท **ไม่จำเป็นต้องมองเป็นชิ้นใหญ่ชิ้นเดียว**
> - สามารถคีบที่ **ขอบ (edge)** ของโดนัทแทนได้
>
> **วิธีแก้:**
> - เพิ่มระบบ **Donut Detection** ที่ตรวจจับวัตถุทรงโดนัท
> - ถ้าเป็นโดนัท → เปลี่ยนไปคีบที่ขอบแทน (ตามความหนาของขอบ)
>
> **ผลลัพธ์:** ระบบครอบคลุมวัตถุทุกรูปทรงแล้ว

---

### 🎯 สรุป Phase 1

> **ระบบ Grasp ที่ดีที่สุด = PCA + Donut Detection**
>
> ```
> วัตถุทั่วไป → PCA → คีบด้านสั้น
> วัตถุโดนัท → Donut Detection → คีบที่ขอบ
> ```
>
> ✅ ได้ระบบเลือกจุดจับที่สมบูรณ์แล้ว → พร้อมไปแก้ปัญหาถัดไป

---

## PHASE 2: การหาวิธีวัด Depth ที่ดีที่สุด

> เมื่อได้ระบบ Grasp ที่ดีแล้ว ปัญหาถัดไปคือ **"จะรู้ได้อย่างไรว่าต้องลง gripper ลึกแค่ไหน?"** นี่คือปัญหาการวัดความสูงของวัตถุ

---

### 🔴 [v4] เริ่มต้นด้วย Depth AI (Depth Anything V2)

> เราเลือกใช้ **Depth Anything V2** ซึ่งเป็น AI ที่ประมาณความลึกจากภาพกล้องตัวเดียว (Monocular Depth Estimation)
>
> **ปัญหาที่เจอ (ร้ายแรงมาก):**
>
> | ปัญหา | รายละเอียด |
> |-------|------------|
> | **แสงมีผลมากที่สุด** | แสงเปลี่ยนนิดเดียว ค่า depth เพี้ยนหมด |
> | **Relative ไม่ใช่ Absolute** | ได้แค่ค่า "ใกล้กว่า-ไกลกว่า" ไม่ใช่ระยะจริงเป็น mm |
> | **Calibrate ยากมาก** | ต้องหาค่า DEPTH_Z_SCALE ซึ่งไม่คงที่ในทุกพื้นที่ |
> | **Scale Ambiguity** | วัตถุเล็กอยู่ใกล้ กับ วัตถุใหญ่อยู่ไกล → AI เห็นเหมือนกัน |
> | **ไม่เสถียร** | Run ซ้ำๆ ได้ค่าต่างกันทุกครั้ง |
>
> **ตัวอย่างสถานการณ์จริง:**
> - เช้า: Calibrate เสร็จ → ใช้งานได้
> - บ่าย: แสงเปลี่ยน → error ±15mm → หยิบไม่ถึง หรือ ชนวัตถุ
> - ต้อง Calibrate ใหม่ทุกครั้งที่แสงเปลี่ยน → **ใช้งานจริงไม่ได้**
>
> **ข้อสรุป:** Depth AI ไม่เหมาะสำหรับงานที่ต้องการความแม่นยำ

---

### 🟢 [v5] เปลี่ยนมาใช้ LIDAR

> เมื่อ Depth AI ใช้ไม่ได้ เราจึงเปลี่ยนมาใช้ **LIDAR (TF-Luna)** ซึ่งเป็นเซ็นเซอร์วัดระยะทางด้วยแสง IR
>
> **ข้อดีของ LIDAR:**
>
> | ข้อดี | รายละเอียด |
> |-------|------------|
> | **วัดค่าจริง (mm)** | ได้ระยะทางจริง ไม่ใช่ค่าประมาณ |
> | **ไม่ขึ้นกับแสงภายนอก** | ใช้แสง IR ของตัวเอง |
> | **แม่นยำสูง** | accuracy ±2mm |
> | **เร็วมาก** | 250Hz sampling rate |
> | **ไม่ต้อง Calibrate บ่อย** | ค่าคงที่ตลอดการใช้งาน |
>
> **ผลการทดลอง:**
> - วัดความสูงได้แม่นยำ ±2mm
> - ทำงานได้ในทุกสภาพแสง
> - ไม่ต้อง calibrate ใหม่ทุกวัน
>
> **ข้อสรุป:** LIDAR คือคำตอบสำหรับการวัดความสูง

---

### 🎯 สรุป Phase 2

> **ระบบวัดความสูงที่ดีที่สุด = LIDAR**
>
> ```
> Depth AI → ❌ ไม่เสถียร, แสงมีผล
> LIDAR → ✅ แม่นยำ, เสถียร, ใช้งานได้จริง
> ```
>
> ✅ ได้ระบบวัดความสูงที่สมบูรณ์แล้ว

---

## FINAL: ผนวกรวมระบบ

> เมื่อได้ทั้ง 2 ระบบที่ดีที่สุดแล้ว เราจึงนำมาผนวกกัน:
>
> ```
> ┌─────────────────────────────────────────────────────────────┐
> │                  COMPLETE SYSTEM                            │
> ├─────────────────────────────────────────────────────────────┤
> │                                                             │
> │  🎯 GRASP SELECTION (Phase 1)                               │
> │     ├── PCA → วัตถุทั่วไป → คีบด้านสั้น                      │
> │     └── Donut Detection → วัตถุโดนัท → คีบที่ขอบ            │
> │                                                             │
> │  📏 HEIGHT MEASUREMENT (Phase 2)                            │
> │     └── LIDAR (TF-Luna) → วัดความสูงจริง (mm)               │
> │                                                             │
> │  🤖 ROBOT CONTROL                                           │
> │     └── Dobot MG400 + Servo Gripper                        │
> │                                                             │
> └─────────────────────────────────────────────────────────────┘
> ```

---

## 📌 บทเรียนที่ได้

| หัวข้อ | บทเรียน |
|--------|--------|
| **การพัฒนาแบบ Step-by-step** | แก้ปัญหาทีละอย่าง (Grasp ก่อน → Depth ทีหลัง) ทำให้ debug ง่าย |
| **AI ไม่ใช่คำตอบเสมอ** | ถ้า Dataset/Setup ไม่ตรง → ผลลัพธ์ไม่ดี |
| **วิธีคลาสสิกอาจดีกว่า** | PCA ง่ายกว่า เร็วกว่า และแม่นยำกว่า Grasp AI ในกรณีนี้ |
| **เซ็นเซอร์จริง ชนะ AI** | LIDAR วัดค่าจริง ดีกว่า Depth AI ที่ประมาณค่า |
| **กรณีพิเศษต้องมีวิธีพิเศษ** | Donut ใช้ PCA ไม่ได้ → ต้องมี detection แยก |

---

## 🔄 แผนภาพสรุป

```
                    ┌─────────────────┐
                    │  START PROJECT  │
                    └────────┬────────┘
                             │
         ╔═══════════════════╧═══════════════════╗
         ║         PHASE 1: GRASP SELECTION      ║
         ╚═══════════════════╤═══════════════════╝
                             │
                    ┌────────▼────────┐
                    │   Grasp AI      │
                    │   (Deep Learn)  │
                    └────────┬────────┘
                             │ ❌ ไม่แม่น
                             │   (มุมกล้อง, Gripper ไม่ตรง)
                    ┌────────▼────────┐
                    │   PCA Grasp     │
                    └────────┬────────┘
                             │ ✅ ดีมาก!
                             │   (คีบด้านสั้นเหมือนมนุษย์)
                    ┌────────▼────────┐
                    │  + Donut Detect │
                    └────────┬────────┘
                             │ ✅ ครอบคลุมทุกรูปทรง
                             │
         ╔═══════════════════╧═══════════════════╗
         ║  🎯 RESULT: PCA + Donut = Best Grasp  ║
         ╚═══════════════════╤═══════════════════╝
                             │
         ╔═══════════════════╧═══════════════════╗
         ║       PHASE 2: HEIGHT MEASUREMENT     ║
         ╚═══════════════════╤═══════════════════╝
                             │
                    ┌────────▼────────┐
                    │   Depth AI      │
                    │ (Depth Anything)│
                    └────────┬────────┘
                             │ ❌ ไม่เสถียร
                             │   (แสงมีผล, calibrate ยาก)
                    ┌────────▼────────┐
                    │     LIDAR       │
                    │   (TF-Luna)     │
                    └────────┬────────┘
                             │ ✅ แม่นยำมาก!
                             │   (วัดค่าจริง mm)
                             │
         ╔═══════════════════╧═══════════════════╗
         ║    🎯 RESULT: LIDAR = Best Depth      ║
         ╚═══════════════════╤═══════════════════╝
                             │
         ╔═══════════════════╧═══════════════════╗
         ║           FINAL SYSTEM                ║
         ║   PCA + Donut + LIDAR = Complete!     ║
         ╚═══════════════════════════════════════╝
```

---

**Document Version:** 1.0  
**Created:** December 2024  
**Project:** Robotic Grasping System Evolution
